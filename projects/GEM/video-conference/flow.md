# Flow Ä‘Äƒng nháº­p SSO vá»›i Microsoft Teams

## Flow chung

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User open web application  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check localStorage for token â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚
       â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ No token     â”‚   â”‚ Token exists               â”‚
â”‚ â†’ Redirect   â”‚   â”‚ Verify with /api/auth/me   â”‚
â”‚ to Login     â”‚   â”‚ Authorization: Bearer JWT  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                                     â”‚
               â–¼                                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Token valid           â”‚            â”‚ Token expired       â”‚
   â”‚ â†’ User logged in      â”‚            â”‚ â†’ Clear storage     â”‚
   â”‚ â†’ Join meeting        â”‚            â”‚ â†’ Redirect login    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TrÆ°á»ng há»£p 1: User chÆ°a Ä‘Äƒng nháº­p app (Login with Teams)

```mermaid
sequenceDiagram
  participant U as ðŸ‘¤ User
  participant F as ðŸŒ Frontend
  participant B as ðŸ–¥ï¸ Backend
  participant M as â˜ï¸ Microsoft Login (Entra ID)

  U->>F: Click "Login with Teams"
  F->>B: GET /api/auth/login
  B-->>U: Redirect â†’ login.microsoftonline.com
  U->>M: Request Microsoft Login
  M-->>U: Detect existing session â†’ skip login
  M-->>B: Redirect /api/auth/callback?code=xxx&state=yyy
  B->>M: Exchange code â†’ access_token, id_token
  B->>B: Handle logic
  B->>F: Redirect with app JWT token
  F->>F: Save token (localStorage)
  F->>U: User logged in â†’ Join Jitsi meeting
```

### TrÆ°á»ng há»£p 2: User Ä‘Ã£ cÃ³ JWT há»£p lá»‡

```mermaid
sequenceDiagram
  participant U as ðŸ‘¤ User
  participant F as ðŸŒ Frontend
  participant B as ðŸ–¥ï¸ Backend

  U->>F: Access web app
  F->>F: Check localStorage for token
  alt Token exists
      F->>B: GET /api/auth/me (Authorization: Bearer token)
      alt Token valid
          B-->>F: Return user info âœ…
          F->>U: User logged in â†’ Join Jitsi meeting
      else Token expired
          B-->>F: 401 Unauthorized âŒ
          F->>F: Clear token â†’ redirect login
      end
  else No token
      F->>U: Redirect to login page
  end
```
